---
title: "CloudFrontã§URLã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è‡ªå‹•ã§ä»˜ã‘ã‚‹"
emoji: "ğŸ“²"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["aws", "cloudfront"]
published: true
---
ã“ã‚“ã«ã¡ã¯ï¼Œ[@ry_km](https://twitter.com/ry_km_u_u)ã§ã™ã€‚Zenn2è¨˜äº‹ç›®ã§ã™ã€‚

ã¿ãªã•ã‚“AWSã®S3+CloudFrontä½¿ã£ã¦ã¾ã™ã‹ï¼Ÿ
ç°¡å˜ã«ä½ã‚³ã‚¹ãƒˆã§ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®é‹ç”¨ãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã§ï¼Œ[SPA](https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3)(Single-Page Application)ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã®ã«å¤§å¤‰é‡å®ã—ã¦ã„ã¾ã™ã€‚

ãŸã åˆæœŸè¨­å®šã“ãç°¡å˜ã§ã™ãŒï¼Œé‹ç”¨ä¸­ã«ã¤ã¾ã¥ããƒã‚¤ãƒ³ãƒˆãŒå¤šã€…ã‚ã‚Šã¾ã™ã€‚
ä»Šå›ã¯ï¼Œãã®ä¸­ã§ã‚‚ã‚ã¾ã‚ŠçŸ¥ã‚‰ã‚Œã¦ã„ãªã„ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®šæ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

# S3+CloudFrontã®Webãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã¨ã¯ï¼Ÿ
S3ã¯AWSã®ä»£è¡¨çš„ãªã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚µãƒ¼ãƒ“ã‚¹ï¼ŒCloudFrontã¯åŒã˜ãAWSè¬¹è£½ã®CDNã§ã™ã€‚S3ã«ã¯[é™çš„Webãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°](https://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/WebsiteHosting.html)ã¨ã„ã†æ©Ÿèƒ½ãŒã‚ã‚Šï¼Œã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å¿…è¦ã¨ã—ãªã„Webãƒšãƒ¼ã‚¸ï¼ˆPHPã‚„ASP.NETãªã©ã‚’ä½¿ã‚ãªã„ãƒšãƒ¼ã‚¸ï¼‰ã®ãƒ›ã‚¹ãƒˆãŒç°¡å˜ã«ã§ãã¾ã™ã€‚
S3ã®ãƒã‚±ãƒƒãƒˆã¯ã‚¢ã‚¯ã‚»ã‚¹æ¨©ï¼ˆãƒãƒªã‚·ãƒ¼ï¼‰ã‚’è‡ªç”±ã«è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ï¼Œã€Œä½œæˆè€…ã¯å¤‰æ›´ãƒ»èª­ã¿å–ã‚Šè¨±å¯ï¼Œãã®ä»–ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã€ã¨ãƒãƒªã‚·ãƒ¼ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå¯èƒ½ã§ã™ã€‚

## ãƒ¡ãƒªãƒƒãƒˆ
- Apacheã‚„Nginxãªã©ã®ç´°ã‹ã„è¨­å®šã‚’ã™ã‚‹å¿…è¦ãŒãªã„
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã§ã®é‹ç”¨ãŒå¯èƒ½ï¼ˆãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãªã®ã§åˆ©ç”¨æ–™ãŒå®‰ã„ï¼‰
- ãƒ‡ãƒ¼ã‚¿ã®è€ä¹…æ€§ãŒéå¸¸ã«é«˜ã„

## CloudFrontã¨ã®çµ„ã¿åˆã‚ã›
ã¾ãŸï¼ŒCloudFrontã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ä»¥ä¸‹ã®ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
- HTTPSåŒ–ï¼ˆACLã§è¨¼æ˜æ›¸ã‚’ç™ºè¡Œã™ã‚‹å¿…è¦ã‚ã‚Šï¼‰
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å–ã£ã¦èª­ã¿è¾¼ã¿ã‚’é«˜é€ŸåŒ–
- S3ãƒã‚±ãƒƒãƒˆã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ãšã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãŒå¯èƒ½ï¼ˆCloudFrontã‚’ä½¿ã£ã¦é–“æ¥çš„ã«ãƒã‚±ãƒƒãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ï¼‰ãªãŸã‚ï¼Œã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¼çš„ã«å®‰å¿ƒ

æœ€è¿‘ã¯httpsã§ãªã„ã¨[SEOã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒä¸‹ãŒã‚‹](https://developers.google.com/search/blog/2014/08/https-as-ranking-signal)ã‚‰ã—ã„ã®ã§ï¼Œãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®HTTPSåŒ–ã¯å¿…é ˆã§ã™ã­ã€‚ã—ãŸãŒã£ã¦ï¼ŒåŸºæœ¬çš„ã«S3ã¨CloudFrontã¯çµ„ã¿åˆã‚ã›ã¦ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®šã«ã¤ã„ã¦
ä¸€æ–¹ã§å¤§æŠµã®ãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã«ã‚ã£ã¦ï¼ŒS3+CloudFrontã«ã¯ãªã„æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚ãã®ä¸€ã¤ãŒã€Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æŒ‡å®šã€ã§ã™ã€‚
ä¾‹ãˆã°ï¼ŒãŠåå‰.comã®ãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã«ã¯æ¬¡ã®ã‚ˆã†ãªè¨˜è¼‰ãŒã‚ã‚Šã¾ã™ã€‚

![ãŠåå‰.comãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å„ªå…ˆé †ä½](/images/cloudfront-function-rewrite-uri/onamae-server-index.png)
*ãŠåå‰.comãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å„ªå…ˆé †ä½ã€‚å‡ºå…¸ï¼š[https://help.onamae.com/answer/20292](https://help.onamae.com/answer/20292)*

ã“ã®ã‚ˆã†ã«ï¼Œãƒ¬ãƒ³ã‚¿ãƒ«ã‚µãƒ¼ãƒãƒ¼ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§index.htmlã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã™ã­ï¼ˆApacheã®å†…éƒ¨è¨­å®šã§å¯èƒ½ï¼‰ã€‚ã¤ã¾ã‚Šï¼Œ`example.com`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨è‡ªå‹•çš„ã«`example.com/index.html`ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã—ã‹ã—ãªãŒã‚‰ï¼Œãƒãƒ‹ãƒ¥ã‚¢ãƒ«é‹è»¢ã®AWS^[AWSã¯è‡ªç”±ãŒåˆ©ãåˆ†ãƒãƒ‹ãƒ¥ã‚¢ãƒ«é‹è»¢ã«è¿‘ã„ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ï¼Œ[ã‚µãƒ–ãƒãƒƒãƒˆã®ãƒ—ãƒ©ã‚¤ã¹ãƒ¼ãƒˆãƒ»ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã®è¨­å®š](https://blog.serverworks.co.jp/tech/2013/05/23/vpc_beginner-2/)ä¸€ã¤ã¨ã£ã¦ã‚‚ãã†ã§ã™ã€‚ã¡ãªã¿ã«ç­†è€…ã¯è‹¥è€…ã«ã¯çã—ã(?)ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§å…è¨±ã‚’å–ã‚Šã¾ã—ãŸã€‚]ã§ã¯ãã†ã‚‚ã„ãã¾ã›ã‚“ã€‚S3+CloudFrontã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã„ã‚‹å ´åˆï¼Œã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®šã«é–¢ã—ã¦ä»¥ä¸‹ã®åˆ¶é™ãŒã‚ã‚Šã¾ã™ã€‚
- ãƒã‚±ãƒƒãƒˆã®ãƒ«ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹å ´åˆï¼Œæœ«å°¾ã®`index.html`ã¯çœç•¥å¯èƒ½ï¼ˆ[è¨­å®šæ–¹æ³•](https://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/DefaultRootObject.html)ï¼‰
- ãƒã‚±ãƒƒãƒˆã®ãƒ«ãƒ¼ãƒˆä»¥å¤–ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã„ã‚‹å ´åˆï¼Œæœ«å°¾ã®`index.html`ã¯çœç•¥ä¸å¯

ã—ãŸãŒã£ã¦ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªã‚¢ã‚¯ã‚»ã‚¹ã§ã¯403ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™ã€‚
- ã‚¢ã‚¯ã‚»ã‚¹å…ˆï¼š`s3://example-bucket/hoge/index.html`
- `example.com`ã«ç´ã¥ã‘ãŸãƒã‚±ãƒƒãƒˆï¼š`s3://example-bucket/`
- ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸãƒªãƒ³ã‚¯ï¼š`example.com/hoge/`

`wget`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã†ã¨ã“ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
![ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’çœç•¥ã—ãŸå ´åˆ](/images/cloudfront-function-rewrite-uri/403-forbidden.png)
*ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’çœç•¥ã—ãŸå ´åˆã€‚`/api`ã«ã¯index.htmlãŒå…¥ã‚Œã¦ã‚ã‚Šã¾ã™ã€‚*

ã—ã‹ã—ã“ã‚ŒãŒä½¿ã„ã«ãã„...ã„ã¡ã„ã¡index.htmlã¾ã§æ‰“ãŸãªã„ã¨ã„ã‘ãªã„ã®ã§ï¼Œã‹ãªã‚Šãƒ¡ãƒ³ãƒ‰ã‚¯ã‚µã‚¤ã§ã™ï¼
ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ï¼ŒCloudFront Functionsã‚’ä½¿ã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ‘ã‚¹ã‚’æ›¸ãæ›ãˆã‚‹ã¨ã„ã†ã“ã¨ã‚’ã—ã¾ã™ã€‚

# CloudFront Functionsã¨ã¯ï¼Ÿ
[CloudFront Functions](https://aws.amazon.com/jp/blogs/news/introducing-cloudfront-functions-run-your-code-at-the-edge-with-low-latency-at-any-scale/)ï¼ˆä»¥ä¸‹CF2ã¨æ›¸ãã¾ã™ï¼‰ã¯ï¼Œ2021/5/6ã«ãƒ­ãƒ¼ãƒ³ãƒã•ã‚ŒãŸæ¯”è¼ƒçš„æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚

>ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’å¯èƒ½ãªé™ã‚Šæœ€å°ã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã§æä¾›ã™ã‚‹ãŸã‚ã«ã€ä»Šæ—¥ã®å¤šãã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã‚¨ãƒƒã‚¸ã§ä½•ã‚‰ã‹ã®å½¢å¼ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
>
>ã“ã®(...)ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’æ”¯æ´ã™ã‚‹ãŸã‚ã«ã€218 ä»¥ä¸Šã® CloudFront ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§è»½é‡ã® JavaScript ã‚³ãƒ¼ãƒ‰ã‚’ Lambda@Edge ã® 1/6 ã®ã‚³ã‚¹ãƒˆã§å®Ÿè¡Œã§ãã‚‹æ–°ã—ã„ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚ã‚‹ CloudFront Functions ã®æä¾›ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã€‚

ï¼ˆå¼•ç”¨ï¼š[CloudFront Functions ã®å°å…¥ â€“ ä»»æ„ã®è¦æ¨¡ã«ãŠã„ã¦ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼ã§ã‚³ãƒ¼ãƒ‰ã‚’ã‚¨ãƒƒã‚¸ã§å®Ÿè¡Œ](https://aws.amazon.com/jp/blogs/news/introducing-cloudfront-functions-run-your-code-at-the-edge-with-low-latency-at-any-scale/)ï¼‰

ä¼¼ãŸã‚ˆã†ãªã‚µãƒ¼ãƒ“ã‚¹ã«Lambda@EdgeãŒã‚ã‚Šã¾ã™ãŒï¼ŒCF2ã«ã¯ä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã€‚
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ï¼šJavaScriptã®ã¿ï¼ˆECMAScript5.1æº–æ‹ ï¼‰
- å®Ÿè¡Œå ´æ‰€ï¼š218ã®CloudFrontã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³^[CloudFrontã«ã¯è¨ˆ13ã®ã‚¨ãƒƒã‚¸ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¨è¨ˆ300ä»¥ä¸Šã®ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚[å‡„ã¾ã˜ã„ã§ã™ã­](https://aws.amazon.com/jp/cloudfront/features/?whats-new-cloudfront.sort-by=item.additionalFields.postDateTime&whats-new-cloudfront.sort-order=desc)ã€‚]
- å®Ÿè¡Œæ™‚é–“ï¼š1msã¾ã§
- ä½¿ç”¨å¯èƒ½ãƒ¡ãƒ¢ãƒªï¼š2MBã¾ã§
- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚µã‚¤ã‚ºï¼š10KBã¾ã§
- ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã¿ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã¨ã—ã¦ä¸ãˆã‚‰ã‚Œã‚‹
- VPCãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ä¸å¯

ã‚¨ãƒƒã‚¸ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè¡Œã§ãã‚‹ã¨ã„ã†ã®ãŒæ¿€ã‚¢ãƒ„ã§ã™ï¼1msä»¥å†…ã¨ã„ã†åˆ¶é™ãŒã‚ã‚‹ã®ã§ï¼Œä½¿ç”¨ç”¨é€”ã¯ãƒ‘ã‚¹ã®æ›¸ãæ›ãˆã‚„ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãªã©ã‹ãªã‚Šçµã‚‰ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚
æ³¨æ„ãŒå¿…è¦ãªã®ã¯ï¼ŒJSã¨ã¯ã„ã£ã¦ã‚‚ECMAScript5.1æº–æ‹ ã¨ã„ã†ç‚¹ã§ã™ã­ã€‚`let`ã‚„`const`ã¯ECMAScript6 (2015)ã§å°å…¥ã•ã‚ŒãŸã®ã§ï¼Œ`var`ã—ã‹ä½¿ç”¨ã§ãã¾ã›ã‚“^[æœ€åˆãã‚Œã‚’çŸ¥ã‚‰ãªã„ã§`const`ã‚’ä½¿ã£ã¦æ›¸ã„ãŸã‚‰æ€’ã‚‰ã‚Œã¾ã—ãŸã€‚]ã€‚ã‚¢ãƒ­ãƒ¼é–¢æ•°ï¼ˆ`const hoge = () => {}`ï¼‰ã‚‚ä½¿ãˆã¾ã›ã‚“ã€‚

# å®Ÿéš›ã«ã‚„ã£ã¦ã¿ã‚‹
ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚
```js
function handler(event) {
    var request = event.request
    var uri = request.uri;
    if (uri.endsWith('/')) {
        request.uri += 'index.html';
    } else if (!uri.includes('.')) {
        request.uri += '/index.html';
    }
    return request;
}
```

ä»Šå›ã¯[AWSå…¬å¼ã®ã‚³ãƒ¼ãƒ‰](https://github.com/aws-samples/amazon-cloudfront-functions/tree/main/url-rewrite-single-page-apps)ã‚’ãŠå€Ÿã‚Šã—ã¾ã—ãŸã€‚ã“ã‚Œã‚’CF2ã«è¨­å®šã—ã¦ã„ãã¾ã™ã€‚

## 1. CloudFront Functionsã‚’é–‹ã
CloudFrontã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã‚ã‚‹é–¢æ•°ã‚’é–‹ãã¾ã™
![CloudFrontã®ã‚µã‚¤ãƒ‰ãƒãƒ¼](/images/cloudfront-function-rewrite-uri/cf2-menu.png)

## 2. é–¢æ•°ã‚’ä½œæˆ
é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚åå‰ã¨èª¬æ˜ã‚’å…¥åŠ›ã—ã¾ã™ã€‚èª¬æ˜ã¯ã„ã¤ã‚‚é€šã‚Šçœç•¥å¯ã§ã™ã€‚
![CloudFront Functionã®ä½œæˆ](/images/cloudfront-function-rewrite-uri/cf2-create-function.png)

ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ãƒ»ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™ã€‚
![CloudFront Functionã‚³ãƒ¼ãƒ‰ã®å…¥åŠ›](/images/cloudfront-function-rewrite-uri/cf2-create-function-package.png)

## 3. ç™ºè¡Œãƒ»é–¢é€£ä»˜ã‘
é–¢æ•°ã‚’ç™ºè¡Œã—ã¾ã™ã€‚ç™ºè¡Œã‚¿ãƒ–ã«ç§»å‹•ã—ã¦ï¼Œé–¢æ•°ã‚’ç™ºè¡Œã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚
![CloudFront Functionã®ç™ºè¡Œ](/images/cloudfront-function-rewrite-uri/cf2-publish-function.png)

ãã®å¾Œï¼Œãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨é–¢é€£ä»˜ã‘ã‚’è¨­å®šã—ã¾ã™ã€‚
![CloudFront Functionã®é–¢é€£ä»˜ã‘1](/images/cloudfront-function-rewrite-uri/cf2-publish-function-distribution1.png)
![CloudFront Functionã®é–¢é€£ä»˜ã‘2](/images/cloudfront-function-rewrite-uri/cf2-publish-function-distribution2.png)

ã“ã‚Œã§å®Œæˆã§ã™ï¼æ“ä½œè‡ªä½“ã¯ã¨ã¦ã‚‚ç°¡å˜ã§ã™ã­ã€‚

# ã¾ã¨ã‚
æ›´æ–°ã—ãŸãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã™ãã«åæ˜ ã•ã‚Œã¾ã™ã€‚æœ€å¾Œã«`wget`ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
![wgetã‚³ãƒãƒ³ãƒ‰ã®çµæœ](/images/cloudfront-function-rewrite-uri/200-1.png)

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã‚‚ãã¡ã‚“ã¨`index.html`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
S3+CloudFrontã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã¨ãã«ãœã²ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ï¼
